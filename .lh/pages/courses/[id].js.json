{
    "sourceFile": "pages/courses/[id].js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 13,
            "patches": [
                {
                    "date": 1755825973134,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755826015231,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -339,9 +339,9 @@\n   }\n \n   return (\n     <>\n-      <Navbar user={user} userData={userData} />\n+      <Navbar user={user} userData={userData} />{\" \"}\n       <div className=\"min-h-screen bg-gray-50 py-8\">\n         <div className=\"max-w-6xl mx-auto px-4\">\n           {/* Encabezado */}\n           <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\n"
                },
                {
                    "date": 1755826233235,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -339,9 +339,9 @@\n   }\n \n   return (\n     <>\n-      <Navbar user={user} userData={userData} />{\" \"}\n+      <Navbar user={user} userData={user} />{\" \"}\n       <div className=\"min-h-screen bg-gray-50 py-8\">\n         <div className=\"max-w-6xl mx-auto px-4\">\n           {/* Encabezado */}\n           <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\n"
                },
                {
                    "date": 1755826438720,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -336,9 +336,17 @@\n         </button>\n       </div>\n     );\n   }\n+  // Funci√≥n para convertir cualquier URL de YouTube a embed\n+  const getEmbedUrl = (url) => {\n+    const regExp =\n+      /^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|\\&v=)([^#\\&\\?]*).*/;\n+    const match = url.match(regExp);\n+    const videoId = match && match[2].length === 11 ? match[2] : null;\n \n+    return videoId ? `https://www.youtube.com/embed/${videoId}` : url;\n+  };\n   return (\n     <>\n       <Navbar user={user} userData={user} />{\" \"}\n       <div className=\"min-h-screen bg-gray-50 py-8\">\n@@ -392,9 +400,9 @@\n                 <div>\n                   <p>‚ñ∂Ô∏è Video</p>\n                   <iframe\n                     className=\"w-full h-60 mt-2 rounded\"\n-                    src={selectedLesson.content.replace(\"watch?v=\", \"embed/\")}\n+                    src={getEmbedUrl(selectedLesson.content)}\n                     title=\"Video\"\n                     allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                     allowFullScreen\n                   ></iframe>\n"
                },
                {
                    "date": 1755826456681,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -399,9 +399,9 @@\n               {selectedLesson.type === \"video\" && (\n                 <div>\n                   <p>‚ñ∂Ô∏è Video</p>\n                   <iframe\n-                    className=\"w-full h-60 mt-2 rounded\"\n+                    className=\"w-full h-96 mt-2 rounded\"\n                     src={getEmbedUrl(selectedLesson.content)}\n                     title=\"Video\"\n                     allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                     allowFullScreen\n"
                },
                {
                    "date": 1755826469120,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -399,9 +399,9 @@\n               {selectedLesson.type === \"video\" && (\n                 <div>\n                   <p>‚ñ∂Ô∏è Video</p>\n                   <iframe\n-                    className=\"w-full h-96 mt-2 rounded\"\n+                    className=\" mt-2 rounded\"\n                     src={getEmbedUrl(selectedLesson.content)}\n                     title=\"Video\"\n                     allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                     allowFullScreen\n"
                },
                {
                    "date": 1755826481910,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -399,9 +399,9 @@\n               {selectedLesson.type === \"video\" && (\n                 <div>\n                   <p>‚ñ∂Ô∏è Video</p>\n                   <iframe\n-                    className=\" mt-2 rounded\"\n+                    className=\"w-full h-auto mt-2 rounded\"\n                     src={getEmbedUrl(selectedLesson.content)}\n                     title=\"Video\"\n                     allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                     allowFullScreen\n"
                },
                {
                    "date": 1755826493001,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -399,9 +399,9 @@\n               {selectedLesson.type === \"video\" && (\n                 <div>\n                   <p>‚ñ∂Ô∏è Video</p>\n                   <iframe\n-                    className=\"w-full h-auto mt-2 rounded\"\n+                    className=\"w-full min-h-[400px] mt-2 rounded\"\n                     src={getEmbedUrl(selectedLesson.content)}\n                     title=\"Video\"\n                     allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                     allowFullScreen\n"
                },
                {
                    "date": 1755826499704,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -399,9 +399,9 @@\n               {selectedLesson.type === \"video\" && (\n                 <div>\n                   <p>‚ñ∂Ô∏è Video</p>\n                   <iframe\n-                    className=\"w-full min-h-[400px] mt-2 rounded\"\n+                    className=\"w-full min-h-[600px] mt-2 rounded\"\n                     src={getEmbedUrl(selectedLesson.content)}\n                     title=\"Video\"\n                     allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                     allowFullScreen\n"
                },
                {
                    "date": 1755826545822,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -397,9 +397,8 @@\n               )}\n \n               {selectedLesson.type === \"video\" && (\n                 <div>\n-                  <p>‚ñ∂Ô∏è Video</p>\n                   <iframe\n                     className=\"w-full min-h-[600px] mt-2 rounded\"\n                     src={getEmbedUrl(selectedLesson.content)}\n                     title=\"Video\"\n"
                },
                {
                    "date": 1755827741839,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,9 +11,8 @@\n   where,\n   getDocs,\n } from \"firebase/firestore\";\n import { auth, db } from \"../../lib/firebase\";\n-import Navbar from \"../../components/Navbar\"; // Aseg√∫rate de tener un Navbar\n \n export default function StudentCoursePage() {\n   const router = useRouter();\n   const { id } = router.query;\n@@ -346,239 +345,232 @@\n \n     return videoId ? `https://www.youtube.com/embed/${videoId}` : url;\n   };\n   return (\n-    <>\n-      <Navbar user={user} userData={user} />{\" \"}\n-      <div className=\"min-h-screen bg-gray-50 py-8\">\n-        <div className=\"max-w-6xl mx-auto px-4\">\n-          {/* Encabezado */}\n-          <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\n-            <h1 className=\"text-2xl font-bold text-gray-800\">{course.title}</h1>\n-            <p className=\"text-sm text-gray-500 mt-2\">\n-              Progreso: {progress.length} / {course.lessons?.length || 0}{\" \"}\n-              lecciones\n-            </p>\n-          </div>\n+    <div className=\"min-h-screen bg-gray-50 py-8\">\n+      <div className=\"max-w-6xl mx-auto px-4\">\n+        {/* Encabezado */}\n+        <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\n+          <h1 className=\"text-2xl font-bold text-gray-800\">{course.title}</h1>\n+          <p className=\"text-sm text-gray-500 mt-2\">\n+            Progreso: {progress.length} / {course.lessons?.length || 0}{\" \"}\n+            lecciones\n+          </p>\n+        </div>\n \n-          {/* √çndice de lecciones */}\n-          <div className=\"bg-white p-4 rounded-lg shadow mb-6\">\n-            <h3 className=\"font-medium mb-2\">√çndice del curso</h3>\n-            <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\">\n-              {course.lessons?.map((lesson, idx) => (\n-                <button\n-                  key={lesson.id}\n-                  onClick={() => goToLesson(idx)}\n-                  className={`p-2 text-xs text-center rounded border ${\n-                    currentLessonIndex === idx\n-                      ? \"bg-blue-100 border-blue-300\"\n-                      : progress.includes(lesson.id)\n-                      ? \"bg-green-100 border-green-300\"\n-                      : \"bg-gray-100 border-gray-300 hover:bg-gray-200\"\n-                  }`}\n-                >\n-                  {idx + 1}. {lesson.title.substring(0, 20)}...\n-                </button>\n-              ))}\n-            </div>\n+        {/* √çndice de lecciones */}\n+        <div className=\"bg-white p-4 rounded-lg shadow mb-6\">\n+          <h3 className=\"font-medium mb-2\">√çndice del curso</h3>\n+          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\">\n+            {course.lessons?.map((lesson, idx) => (\n+              <button\n+                key={lesson.id}\n+                onClick={() => goToLesson(idx)}\n+                className={`p-2 text-xs text-center rounded border ${\n+                  currentLessonIndex === idx\n+                    ? \"bg-blue-100 border-blue-300\"\n+                    : progress.includes(lesson.id)\n+                    ? \"bg-green-100 border-green-300\"\n+                    : \"bg-gray-100 border-gray-300 hover:bg-gray-200\"\n+                }`}\n+              >\n+                {idx + 1}. {lesson.title.substring(0, 20)}...\n+              </button>\n+            ))}\n           </div>\n+        </div>\n \n-          {/* Vista de lecci√≥n */}\n-          {selectedLesson && (\n-            <div className=\"bg-white p-6 rounded-lg shadow mb-8\">\n-              <h2 className=\"text-2xl font-semibold mb-4\">\n-                {selectedLesson.title}\n-              </h2>\n+        {/* Vista de lecci√≥n */}\n+        {selectedLesson && (\n+          <div className=\"bg-white p-6 rounded-lg shadow mb-8\">\n+            <h2 className=\"text-2xl font-semibold mb-4\">\n+              {selectedLesson.title}\n+            </h2>\n \n-              {/* Contenido */}\n-              {selectedLesson.type === \"text\" && (\n-                <p className=\"text-gray-700 leading-relaxed\">\n-                  {selectedLesson.content}\n-                </p>\n-              )}\n+            {/* Contenido */}\n+            {selectedLesson.type === \"text\" && (\n+              <p className=\"text-gray-700 leading-relaxed\">\n+                {selectedLesson.content}\n+              </p>\n+            )}\n \n-              {selectedLesson.type === \"video\" && (\n-                <div>\n-                  <iframe\n-                    className=\"w-full min-h-[600px] mt-2 rounded\"\n-                    src={getEmbedUrl(selectedLesson.content)}\n-                    title=\"Video\"\n-                    allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n-                    allowFullScreen\n-                  ></iframe>\n+            {selectedLesson.type === \"video\" && (\n+              <div>\n+                <iframe\n+                  className=\"w-full min-h-[600px] mt-2 rounded\"\n+                  src={getEmbedUrl(selectedLesson.content)}\n+                  title=\"Video\"\n+                  allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n+                  allowFullScreen\n+                ></iframe>\n+              </div>\n+            )}\n+\n+            {selectedLesson.type === \"pdf\" && (\n+              <div>\n+                <p>üìÑ PDF</p>\n+                <iframe\n+                  className=\"w-full h-96 mt-2 rounded\"\n+                  src={selectedLesson.content}\n+                  title=\"PDF\"\n+                ></iframe>\n+              </div>\n+            )}\n+\n+            {selectedLesson.type === \"quiz\" &&\n+              !quizSubmitted[selectedLesson.id] && (\n+                <div className=\"mt-4 border-t pt-4\">\n+                  <h4 className=\"font-medium mb-3\">Responder Quiz</h4>\n+                  {selectedLesson.content.map((q, qIndex) => (\n+                    <div key={qIndex} className=\"mb-4\">\n+                      <p>\n+                        <strong>{qIndex + 1}.</strong> {q.question}\n+                      </p>\n+                      <div className=\"ml-4 mt-2 space-y-1\">\n+                        {q.options.map((opt, oIndex) => (\n+                          <label key={oIndex} className=\"flex items-center\">\n+                            <input\n+                              type=\"radio\"\n+                              name={`q-${selectedLesson.id}-${qIndex}`}\n+                              onChange={() =>\n+                                handleAnswer(selectedLesson.id, qIndex, oIndex)\n+                              }\n+                              className=\"mr-2\"\n+                            />\n+                            {opt}\n+                          </label>\n+                        ))}\n+                      </div>\n+                    </div>\n+                  ))}\n+                  <button\n+                    onClick={() =>\n+                      submitQuiz(selectedLesson.id, selectedLesson.content)\n+                    }\n+                    className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded\"\n+                  >\n+                    Enviar respuestas\n+                  </button>\n                 </div>\n               )}\n \n-              {selectedLesson.type === \"pdf\" && (\n-                <div>\n-                  <p>üìÑ PDF</p>\n-                  <iframe\n-                    className=\"w-full h-96 mt-2 rounded\"\n-                    src={selectedLesson.content}\n-                    title=\"PDF\"\n-                  ></iframe>\n+            {selectedLesson.type === \"quiz\" &&\n+              quizSubmitted[selectedLesson.id] && (\n+                <div className=\"mt-4 p-4 bg-green-100 rounded\">\n+                  <h4>Quiz completado ‚úÖ</h4>\n+                  <ul>\n+                    {results[selectedLesson.id]?.map((isCorrect, idx) => (\n+                      <li\n+                        key={idx}\n+                        className={\n+                          isCorrect ? \"text-green-800\" : \"text-red-800\"\n+                        }\n+                      >\n+                        Pregunta {idx + 1}:{\" \"}\n+                        {isCorrect ? \"‚úÖ Correcta\" : \"‚ùå Incorrecta\"}\n+                      </li>\n+                    ))}\n+                  </ul>\n                 </div>\n               )}\n \n-              {selectedLesson.type === \"quiz\" &&\n-                !quizSubmitted[selectedLesson.id] && (\n-                  <div className=\"mt-4 border-t pt-4\">\n-                    <h4 className=\"font-medium mb-3\">Responder Quiz</h4>\n-                    {selectedLesson.content.map((q, qIndex) => (\n-                      <div key={qIndex} className=\"mb-4\">\n-                        <p>\n-                          <strong>{qIndex + 1}.</strong> {q.question}\n-                        </p>\n-                        <div className=\"ml-4 mt-2 space-y-1\">\n-                          {q.options.map((opt, oIndex) => (\n-                            <label key={oIndex} className=\"flex items-center\">\n-                              <input\n-                                type=\"radio\"\n-                                name={`q-${selectedLesson.id}-${qIndex}`}\n-                                onChange={() =>\n-                                  handleAnswer(\n-                                    selectedLesson.id,\n-                                    qIndex,\n-                                    oIndex\n-                                  )\n-                                }\n-                                className=\"mr-2\"\n-                              />\n-                              {opt}\n-                            </label>\n-                          ))}\n-                        </div>\n-                      </div>\n-                    ))}\n-                    <button\n-                      onClick={() =>\n-                        submitQuiz(selectedLesson.id, selectedLesson.content)\n-                      }\n-                      className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded\"\n-                    >\n-                      Enviar respuestas\n-                    </button>\n-                  </div>\n-                )}\n+            {/* Calificaci√≥n de la lecci√≥n */}\n+            <div className=\"mt-6 border-t pt-4\">\n+              <h4 className=\"font-medium mb-2\">Califica esta lecci√≥n</h4>\n+              <div className=\"flex mb-2\">\n+                {[1, 2, 3, 4, 5].map((star) => (\n+                  <span\n+                    key={star}\n+                    className=\"text-2xl cursor-pointer\"\n+                    onClick={() =>\n+                      setLessonRatings({\n+                        ...lessonRatings,\n+                        [selectedLesson.id]: star,\n+                      })\n+                    }\n+                    onMouseEnter={() =>\n+                      setLessonHover({\n+                        ...lessonHover,\n+                        [selectedLesson.id]: star,\n+                      })\n+                    }\n+                    onMouseLeave={() => setLessonHover({})}\n+                  >\n+                    {star <=\n+                    (lessonHover[selectedLesson.id] ||\n+                      lessonRatings[selectedLesson.id] ||\n+                      0)\n+                      ? \"‚≠ê\"\n+                      : \"‚òÜ\"}\n+                  </span>\n+                ))}\n+              </div>\n+              <textarea\n+                value={lessonReviews[selectedLesson.id] || \"\"}\n+                onChange={(e) =>\n+                  setLessonReviews({\n+                    ...lessonReviews,\n+                    [selectedLesson.id]: e.target.value,\n+                  })\n+                }\n+                rows=\"2\"\n+                className=\"w-full p-2 border border-gray-300 rounded mb-3\"\n+                placeholder=\"¬øQu√© te pareci√≥ esta lecci√≥n?\"\n+              />\n+            </div>\n \n-              {selectedLesson.type === \"quiz\" &&\n-                quizSubmitted[selectedLesson.id] && (\n-                  <div className=\"mt-4 p-4 bg-green-100 rounded\">\n-                    <h4>Quiz completado ‚úÖ</h4>\n-                    <ul>\n-                      {results[selectedLesson.id]?.map((isCorrect, idx) => (\n-                        <li\n-                          key={idx}\n-                          className={\n-                            isCorrect ? \"text-green-800\" : \"text-red-800\"\n-                          }\n-                        >\n-                          Pregunta {idx + 1}:{\" \"}\n-                          {isCorrect ? \"‚úÖ Correcta\" : \"‚ùå Incorrecta\"}\n-                        </li>\n-                      ))}\n-                    </ul>\n-                  </div>\n-                )}\n+            {/* Bot√≥n: Marcar y avanzar */}\n+            <div className=\"mt-6\">\n+              <button\n+                onClick={() => markAsCompletedAndNext(selectedLesson.id)}\n+                className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-medium\"\n+              >\n+                {currentLessonIndex + 1 < (course.lessons?.length || 0)\n+                  ? \"‚úÖ Marcar y siguiente\"\n+                  : \"‚úÖ Finalizar curso\"}\n+              </button>\n+            </div>\n+          </div>\n+        )}\n \n-              {/* Calificaci√≥n de la lecci√≥n */}\n-              <div className=\"mt-6 border-t pt-4\">\n-                <h4 className=\"font-medium mb-2\">Califica esta lecci√≥n</h4>\n+        {/* Calificaci√≥n del curso (solo si complet√≥ todo) */}\n+        {progress.length === course.lessons?.length &&\n+          !submittedCourseReview && (\n+            <div className=\"bg-white p-6 rounded-lg shadow\">\n+              <h3 className=\"text-xl font-semibold mb-4\">\n+                ¬°Curso completado! üéâ\n+              </h3>\n+              <p>Gracias por completar el curso. Ahora puedes calificarlo.</p>\n+              <div className=\"mt-4\">\n                 <div className=\"flex mb-2\">\n                   {[1, 2, 3, 4, 5].map((star) => (\n                     <span\n                       key={star}\n                       className=\"text-2xl cursor-pointer\"\n-                      onClick={() =>\n-                        setLessonRatings({\n-                          ...lessonRatings,\n-                          [selectedLesson.id]: star,\n-                        })\n-                      }\n-                      onMouseEnter={() =>\n-                        setLessonHover({\n-                          ...lessonHover,\n-                          [selectedLesson.id]: star,\n-                        })\n-                      }\n-                      onMouseLeave={() => setLessonHover({})}\n+                      onClick={() => setCourseRating(star)}\n+                      onMouseEnter={() => setCourseHover(star)}\n+                      onMouseLeave={() => setCourseHover(0)}\n                     >\n-                      {star <=\n-                      (lessonHover[selectedLesson.id] ||\n-                        lessonRatings[selectedLesson.id] ||\n-                        0)\n-                        ? \"‚≠ê\"\n-                        : \"‚òÜ\"}\n+                      {star <= (courseHover || courseRating) ? \"‚≠ê\" : \"‚òÜ\"}\n                     </span>\n                   ))}\n                 </div>\n                 <textarea\n-                  value={lessonReviews[selectedLesson.id] || \"\"}\n-                  onChange={(e) =>\n-                    setLessonReviews({\n-                      ...lessonReviews,\n-                      [selectedLesson.id]: e.target.value,\n-                    })\n-                  }\n-                  rows=\"2\"\n-                  className=\"w-full p-2 border border-gray-300 rounded mb-3\"\n-                  placeholder=\"¬øQu√© te pareci√≥ esta lecci√≥n?\"\n+                  value={courseReviewText}\n+                  onChange={(e) => setCourseReviewText(e.target.value)}\n+                  rows=\"3\"\n+                  className=\"w-full p-3 border border-gray-300 rounded-lg mb-3\"\n+                  placeholder=\"Tu opini√≥n ayuda a mejorar el curso...\"\n                 />\n-              </div>\n-\n-              {/* Bot√≥n: Marcar y avanzar */}\n-              <div className=\"mt-6\">\n                 <button\n-                  onClick={() => markAsCompletedAndNext(selectedLesson.id)}\n-                  className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-medium\"\n+                  onClick={submitCourseReview}\n+                  className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded\"\n                 >\n-                  {currentLessonIndex + 1 < (course.lessons?.length || 0)\n-                    ? \"‚úÖ Marcar y siguiente\"\n-                    : \"‚úÖ Finalizar curso\"}\n+                  Enviar calificaci√≥n\n                 </button>\n               </div>\n             </div>\n           )}\n-\n-          {/* Calificaci√≥n del curso (solo si complet√≥ todo) */}\n-          {progress.length === course.lessons?.length &&\n-            !submittedCourseReview && (\n-              <div className=\"bg-white p-6 rounded-lg shadow\">\n-                <h3 className=\"text-xl font-semibold mb-4\">\n-                  ¬°Curso completado! üéâ\n-                </h3>\n-                <p>Gracias por completar el curso. Ahora puedes calificarlo.</p>\n-                <div className=\"mt-4\">\n-                  <div className=\"flex mb-2\">\n-                    {[1, 2, 3, 4, 5].map((star) => (\n-                      <span\n-                        key={star}\n-                        className=\"text-2xl cursor-pointer\"\n-                        onClick={() => setCourseRating(star)}\n-                        onMouseEnter={() => setCourseHover(star)}\n-                        onMouseLeave={() => setCourseHover(0)}\n-                      >\n-                        {star <= (courseHover || courseRating) ? \"‚≠ê\" : \"‚òÜ\"}\n-                      </span>\n-                    ))}\n-                  </div>\n-                  <textarea\n-                    value={courseReviewText}\n-                    onChange={(e) => setCourseReviewText(e.target.value)}\n-                    rows=\"3\"\n-                    className=\"w-full p-3 border border-gray-300 rounded-lg mb-3\"\n-                    placeholder=\"Tu opini√≥n ayuda a mejorar el curso...\"\n-                  />\n-                  <button\n-                    onClick={submitCourseReview}\n-                    className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded\"\n-                  >\n-                    Enviar calificaci√≥n\n-                  </button>\n-                </div>\n-              </div>\n-            )}\n-        </div>\n       </div>\n-    </>\n+    </div>\n   );\n }\n"
                },
                {
                    "date": 1762996918086,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,8 +46,12 @@\n \n   // --- Estado: √≠ndice actual ---\n   const [currentLessonIndex, setCurrentLessonIndex] = useState(0);\n \n+  // --- NUEVO: Para la calificaci√≥n del profesor ---\n+  const [teacherGrade, setTeacherGrade] = useState(null);\n+  const [loadingTeacherGrade, setLoadingTeacherGrade] = useState(false);\n+\n   // Escuchar autenticaci√≥n\n   useEffect(() => {\n     const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\n       if (currentUser) {\n@@ -59,9 +63,9 @@\n \n     return () => unsubscribe();\n   }, [router]);\n \n-  // Cargar curso y progreso\n+  // Cargar curso, progreso y calificaci√≥n del profesor\n   useEffect(() => {\n     const loadCourseAndProgress = async () => {\n       if (!id || !user) return;\n \n@@ -88,12 +92,16 @@\n           where(\"courseId\", \"==\", id)\n         );\n         const querySnapshot = await getDocs(q);\n \n+        let enrollmentData = null;\n         if (!querySnapshot.empty) {\n-          const data = querySnapshot.docs[0].data();\n-          setProgress(data.progress || []);\n+          enrollmentData = querySnapshot.docs[0].data();\n+          setProgress(enrollmentData.progress || []);\n           setEnrollmentId(querySnapshot.docs[0].id);\n+\n+          // 2.1. Cargar la calificaci√≥n del profesor desde la inscripci√≥n\n+          setTeacherGrade(enrollmentData.grade || null);\n         }\n \n         // 3. Cargar calificaci√≥n del curso\n         const reviewsRef = collection(db, \"reviews\");\n@@ -354,8 +362,32 @@\n           <p className=\"text-sm text-gray-500 mt-2\">\n             Progreso: {progress.length} / {course.lessons?.length || 0}{\" \"}\n             lecciones\n           </p>\n+          {/* Nueva secci√≥n: Mostrar calificaci√≥n del profesor si est√° completo y ya se calificaron todas las lecciones */}\n+          {progress.length === course.lessons?.length && teacherGrade !== null && (\n+            <div className=\"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n+              <h3 className=\"font-semibold text-gray-800\">Calificaci√≥n Final:</h3>\n+              <div className=\"flex items-center mt-1\">\n+                <span className={`text-xl font-bold ${\n+                  teacherGrade >= 6 ? 'text-green-600' : 'text-red-600'\n+                }`}>\n+                  {teacherGrade.toFixed(1)}\n+                </span>\n+                <span className=\"text-sm text-gray-600 ml-1\">/10</span>\n+                <span className=\"text-sm text-gray-600 ml-2\">\n+                  ({teacherGrade >= 6 ? 'Aprobado' : 'No Aprobado'})\n+                </span>\n+              </div>\n+            </div>\n+          )}\n+          {progress.length === course.lessons?.length && teacherGrade === null && (\n+            <div className=\"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg\">\n+              <p className=\"text-sm text-yellow-700\">\n+                üìù El profesor a√∫n no ha asignado tu calificaci√≥n final. Rev√≠sala m√°s tarde.\n+              </p>\n+            </div>\n+          )}\n         </div>\n \n         {/* √çndice de lecciones */}\n         <div className=\"bg-white p-4 rounded-lg shadow mb-6\">\n@@ -572,5 +604,5 @@\n           )}\n       </div>\n     </div>\n   );\n-}\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1762997104579,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -596,9 +596,9 @@\n                 <textarea\n                   value={courseReviewText}\n                   onChange={(e) => setCourseReviewText(e.target.value)}\n                   rows=\"3\"\n-                  className=\"w-full p-3 border border-gray-300 rounded-lg mb-3\"\n+                  className=\"w-full p-3 border border-gray-300 rounded-lg mb-3 placeholder:text-black\"\n                   placeholder=\"Tu opini√≥n ayuda a mejorar el curso...\"\n                 />\n                 <button\n                   onClick={submitCourseReview}\n"
                },
                {
                    "date": 1762997769343,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import { useState, useEffect } from \"react\";\n+import { useState, useEffect, useRef } from \"react\";\n import { useRouter } from \"next/router\";\n import { onAuthStateChanged } from \"firebase/auth\";\n import {\n   doc,\n@@ -48,10 +48,13 @@\n   const [currentLessonIndex, setCurrentLessonIndex] = useState(0);\n \n   // --- NUEVO: Para la calificaci√≥n del profesor ---\n   const [teacherGrade, setTeacherGrade] = useState(null);\n-  const [loadingTeacherGrade, setLoadingTeacherGrade] = useState(false);\n \n+  // --- NUEVO: Para videoconferencia ---\n+  const [jitsiApi, setJitsiApi] = useState(null);\n+  const jitsiContainerRef = useRef(null);\n+\n   // Escuchar autenticaci√≥n\n   useEffect(() => {\n     const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\n       if (currentUser) {\n@@ -183,8 +186,87 @@\n \n     loadCourseAndProgress();\n   }, [id, user]);\n \n+  // --- NUEVO: Cargar Jitsi API cuando se selecciona una clase en vivo ---\n+  useEffect(() => {\n+    if (selectedLesson?.type === \"live\" && jitsiContainerRef.current) {\n+      const loadJitsi = async () => {\n+        // 1. Cargar el script de Jitsi si no est√° ya disponible\n+        if (!window.JitsiMeetExternalAPI) {\n+          const script = document.createElement(\"script\");\n+          script.src = \"https://meet.jit.si/external_api.js\";\n+          script.async = true;\n+          script.onload = () => {\n+            console.log(\"Jitsi API cargada.\");\n+          };\n+          document.head.appendChild(script);\n+        } else {\n+          console.log(\"Jitsi API ya est√° disponible.\");\n+        }\n+\n+        // 2. Esperar a que el script est√© completamente cargado\n+        const waitForJitsi = () => {\n+          if (window.JitsiMeetExternalAPI) {\n+            // 3. Crear la instancia de Jitsi\n+            const domain = \"meet.jit.si\"; // Puedes cambiarlo por tu dominio Jitsi\n+            const options = {\n+              roomName: selectedLesson.content, // Asumiendo que content es el nombre de la sala\n+              width: \"100%\",\n+              height: 600, // Ajusta la altura seg√∫n necesites\n+              parentNode: jitsiContainerRef.current,\n+              userInfo: {\n+                displayName: user?.displayName || user?.email || \"Alumno\",\n+                email: user?.email,\n+              },\n+              configOverwrite: {\n+                startWithAudioMuted: true,\n+                startWithVideoMuted: true,\n+                disableModeratorIndicator: true,\n+                // Opciones para grabaci√≥n (si est√° habilitada en el servidor Jitsi)\n+                // recording: {\n+                //   enabled: true // No se puede forzar la grabaci√≥n aqu√≠ normalmente\n+                // }\n+              },\n+              interfaceConfigOverwrite: {\n+                filmStripOnly: false,\n+                HIDE_INVITE_MORE_HEADER: true,\n+              },\n+            };\n+\n+            const api = new window.JitsiMeetExternalAPI(domain, options);\n+            setJitsiApi(api);\n+\n+            // Opcional: Escuchar eventos de Jitsi\n+            // api.addEventListeners({\n+            //   videoConferenceJoined: () => {\n+            //     console.log(\"Alumno unido a la conferencia\");\n+            //   },\n+            //   videoConferenceLeft: () => {\n+            //     console.log(\"Alumno dej√≥ la conferencia\");\n+            //     // Aqu√≠ podr√≠as marcar la lecci√≥n como completada si es necesario\n+            //     // markAsCompletedAndNext(selectedLesson.id);\n+            //   }\n+            // });\n+          } else {\n+            setTimeout(waitForJitsi, 100);\n+          }\n+        };\n+        waitForJitsi();\n+      };\n+\n+      loadJitsi();\n+    }\n+\n+    // --- Limpiar Jitsi cuando cambia de lecci√≥n o se desmonta el componente ---\n+    return () => {\n+      if (jitsiApi) {\n+        jitsiApi.dispose();\n+        setJitsiApi(null);\n+      }\n+    };\n+  }, [selectedLesson, user]); // Agregamos 'user' para que displayName/email se actualicen si cambian\n+\n   // --- Calificar lecci√≥n ---\n   const submitLessonReview = async (lessonId) => {\n     const rating = lessonRatings[lessonId];\n     const comment = lessonReviews[lessonId] || \"\";\n@@ -454,8 +536,32 @@\n                 ></iframe>\n               </div>\n             )}\n \n+            {/* NUEVO: Tipo de lecci√≥n en vivo */}\n+            {selectedLesson.type === \"live\" && (\n+              <div>\n+                <p>üé• Conectado a la clase en vivo</p>\n+                <div\n+                  ref={jitsiContainerRef}\n+                  className=\"mt-2 rounded overflow-hidden\"\n+                ></div>\n+                 {/* Opcional: Mostrar grabaci√≥n si est√° disponible */}\n+                 {selectedLesson.recordingUrl && (\n+                    <div className=\"mt-4\">\n+                      <h4 className=\"font-medium mb-2\">Revisi√≥n de Clase</h4>\n+                      <iframe\n+                        className=\"w-full h-96 mt-2 rounded\"\n+                        src={selectedLesson.recordingUrl}\n+                        title=\"Grabaci√≥n de la clase\"\n+                        allow=\"autoplay; fullscreen\"\n+                        allowFullScreen\n+                      ></iframe>\n+                    </div>\n+                  )}\n+              </div>\n+            )}\n+\n             {selectedLesson.type === \"quiz\" &&\n               !quizSubmitted[selectedLesson.id] && (\n                 <div className=\"mt-4 border-t pt-4\">\n                   <h4 className=\"font-medium mb-3\">Responder Quiz</h4>\n@@ -611,5 +717,5 @@\n           )}\n       </div>\n     </div>\n   );\n-}\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1755825973134,
            "name": "Commit-0",
            "content": "import { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { onAuthStateChanged } from \"firebase/auth\";\nimport {\n  doc,\n  getDoc,\n  updateDoc,\n  collection,\n  addDoc,\n  query,\n  where,\n  getDocs,\n} from \"firebase/firestore\";\nimport { auth, db } from \"../../lib/firebase\";\nimport Navbar from \"../../components/Navbar\"; // Aseg√∫rate de tener un Navbar\n\nexport default function StudentCoursePage() {\n  const router = useRouter();\n  const { id } = router.query;\n\n  const [user, setUser] = useState(null);\n  const [course, setCourse] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n\n  const [progress, setProgress] = useState([]);\n  const [enrollmentId, setEnrollmentId] = useState(\"\");\n\n  // Para calificaci√≥n del curso\n  const [courseRating, setCourseRating] = useState(0);\n  const [courseHover, setCourseHover] = useState(0);\n  const [courseReviewText, setCourseReviewText] = useState(\"\");\n  const [submittedCourseReview, setSubmittedCourseReview] = useState(false);\n\n  // Para quizzes\n  const [responses, setResponses] = useState({});\n  const [results, setResults] = useState({});\n  const [quizSubmitted, setQuizSubmitted] = useState({});\n\n  // --- NUEVO: Para calificar lecciones ---\n  const [lessonRatings, setLessonRatings] = useState({});\n  const [lessonReviews, setLessonReviews] = useState({});\n  const [lessonHover, setLessonHover] = useState({});\n\n  // --- Ver lecci√≥n actual ---\n  const [selectedLesson, setSelectedLesson] = useState(null);\n\n  // --- Estado: √≠ndice actual ---\n  const [currentLessonIndex, setCurrentLessonIndex] = useState(0);\n\n  // Escuchar autenticaci√≥n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\n      if (currentUser) {\n        setUser(currentUser);\n      } else {\n        router.push(\"/login\");\n      }\n    });\n\n    return () => unsubscribe();\n  }, [router]);\n\n  // Cargar curso y progreso\n  useEffect(() => {\n    const loadCourseAndProgress = async () => {\n      if (!id || !user) return;\n\n      setLoading(true);\n      try {\n        // 1. Cargar curso\n        const courseDocRef = doc(db, \"courses\", id);\n        const courseDocSnap = await getDoc(courseDocRef);\n\n        if (!courseDocSnap.exists()) {\n          setError(\"Curso no encontrado.\");\n          setLoading(false);\n          return;\n        }\n\n        const courseData = courseDocSnap.data();\n        setCourse(courseData);\n\n        // 2. Cargar progreso\n        const enrollmentsRef = collection(db, \"enrollments\");\n        const q = query(\n          enrollmentsRef,\n          where(\"userId\", \"==\", user.uid),\n          where(\"courseId\", \"==\", id)\n        );\n        const querySnapshot = await getDocs(q);\n\n        if (!querySnapshot.empty) {\n          const data = querySnapshot.docs[0].data();\n          setProgress(data.progress || []);\n          setEnrollmentId(querySnapshot.docs[0].id);\n        }\n\n        // 3. Cargar calificaci√≥n del curso\n        const reviewsRef = collection(db, \"reviews\");\n        const r = query(\n          reviewsRef,\n          where(\"courseId\", \"==\", id),\n          where(\"userId\", \"==\", user.uid)\n        );\n        const reviewSnap = await getDocs(r);\n        if (!reviewSnap.empty) {\n          const review = reviewSnap.docs[0].data();\n          setCourseRating(review.rating);\n          setCourseReviewText(review.comment);\n          setSubmittedCourseReview(true);\n        }\n\n        // 4. Cargar respuestas de quizzes\n        const quizAnswersRef = collection(db, \"quiz_answers\");\n        const q2 = query(\n          quizAnswersRef,\n          where(\"courseId\", \"==\", id),\n          where(\"userId\", \"==\", user.uid)\n        );\n        const answersSnap = await getDocs(q2);\n        const responsesTemp = {};\n        const resultsTemp = {};\n        const quizSubmittedTemp = {};\n\n        answersSnap.forEach((doc) => {\n          const data = doc.data();\n          responsesTemp[data.lessonId] = data.answers;\n          resultsTemp[data.lessonId] = data.correct;\n          quizSubmittedTemp[data.lessonId] = true;\n        });\n\n        setResponses(responsesTemp);\n        setResults(resultsTemp);\n        setQuizSubmitted(quizSubmittedTemp);\n\n        // 5. Cargar calificaciones de lecciones\n        const lessonReviewsRef = collection(db, \"lesson_reviews\");\n        const lrQuery = query(\n          lessonReviewsRef,\n          where(\"courseId\", \"==\", id),\n          where(\"userId\", \"==\", user.uid)\n        );\n        const lrSnap = await getDocs(lrQuery);\n        const ratings = {};\n        const reviews = {};\n        lrSnap.forEach((doc) => {\n          const data = doc.data();\n          ratings[data.lessonId] = data.rating;\n          reviews[data.lessonId] = data.comment;\n        });\n        setLessonRatings(ratings);\n        setLessonReviews(reviews);\n\n        // 6. Si hay progreso, ir a la siguiente pendiente\n        let nextIndex = 0;\n        if (courseData.lessons) {\n          nextIndex = courseData.lessons.findIndex(\n            (l) => !progress.includes(l.id)\n          );\n          if (nextIndex === -1) nextIndex = courseData.lessons.length - 1;\n        }\n        setCurrentLessonIndex(Math.max(0, nextIndex));\n\n        // Abrir primera lecci√≥n si hay\n        if (courseData.lessons?.length > 0) {\n          setSelectedLesson(courseData.lessons[nextIndex]);\n        }\n      } catch (err) {\n        console.error(\"Error al cargar el curso:\", err);\n        setError(\"No se pudo cargar el curso.\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadCourseAndProgress();\n  }, [id, user]);\n\n  // --- Calificar lecci√≥n ---\n  const submitLessonReview = async (lessonId) => {\n    const rating = lessonRatings[lessonId];\n    const comment = lessonReviews[lessonId] || \"\";\n\n    if (!rating || rating === 0) {\n      alert(\"Por favor califica la lecci√≥n.\");\n      return;\n    }\n\n    try {\n      await addDoc(collection(db, \"lesson_reviews\"), {\n        lessonId,\n        courseId: id,\n        userId: user.uid,\n        userName: user.displayName || user.email,\n        rating,\n        comment,\n        timestamp: new Date(),\n      });\n      alert(\"¬°Gracias por tu rese√±a!\");\n    } catch (err) {\n      console.error(\"Error al guardar rese√±a de lecci√≥n:\", err);\n      alert(\"No se pudo guardar la rese√±a.\");\n    }\n  };\n\n  // --- Marcar como completada y avanzar ---\n  const markAsCompletedAndNext = async (lessonId) => {\n    if (!lessonId || progress.includes(lessonId)) return;\n\n    const newProgress = [...progress, lessonId];\n    setProgress(newProgress);\n\n    // Guardar en Firestore\n    if (enrollmentId) {\n      try {\n        await updateDoc(doc(db, \"enrollments\", enrollmentId), {\n          progress: newProgress,\n        });\n      } catch (err) {\n        console.error(\"Error al guardar progreso:\", err);\n      }\n    }\n\n    // Guardar calificaci√≥n\n    if (lessonRatings[lessonId]) {\n      try {\n        await addDoc(collection(db, \"lesson_reviews\"), {\n          lessonId,\n          courseId: id,\n          userId: user.uid,\n          rating: lessonRatings[lessonId],\n          comment: lessonReviews[lessonId] || \"\",\n          timestamp: new Date(),\n        });\n      } catch (err) {\n        console.error(\"Error al guardar rese√±a:\", err);\n      }\n    }\n\n    // Buscar siguiente\n    const nextIndex = currentLessonIndex + 1;\n    if (course.lessons && nextIndex < course.lessons.length) {\n      setCurrentLessonIndex(nextIndex);\n      setSelectedLesson(course.lessons[nextIndex]);\n    } else {\n      alert(\"üéâ ¬°Curso completado!\");\n      setSelectedLesson(null);\n    }\n  };\n\n  // --- Cambiar lecci√≥n manualmente ---\n  const goToLesson = (index) => {\n    if (course.lessons && index >= 0 && index < course.lessons.length) {\n      setCurrentLessonIndex(index);\n      setSelectedLesson(course.lessons[index]);\n    }\n  };\n\n  // --- Enviar calificaci√≥n del curso ---\n  const submitCourseReview = async () => {\n    if (courseRating === 0) {\n      alert(\"Por favor califica el curso.\");\n      return;\n    }\n\n    try {\n      await addDoc(collection(db, \"reviews\"), {\n        courseId: id,\n        userId: user.uid,\n        userName: user.displayName || user.email,\n        rating: courseRating,\n        comment: courseReviewText,\n        timestamp: new Date(),\n      });\n      setSubmittedCourseReview(true);\n      alert(\"¬°Gracias por tu rese√±a del curso!\");\n    } catch (err) {\n      console.error(\"Error al enviar rese√±a del curso:\", err);\n      alert(\"No se pudo enviar la rese√±a.\");\n    }\n  };\n\n  // --- Responder quiz ---\n  const submitQuiz = async (lessonId, questions) => {\n    const userAnswers = responses[lessonId] || {};\n    const correctAnswers = questions.map(\n      (q, i) => userAnswers[i] === q.correct\n    );\n    const score = correctAnswers.filter(Boolean).length;\n\n    setResults((prev) => ({ ...prev, [lessonId]: correctAnswers }));\n    setQuizSubmitted((prev) => ({ ...prev, [lessonId]: true }));\n\n    try {\n      await addDoc(collection(db, \"quiz_answers\"), {\n        courseId: id,\n        lessonId,\n        userId: user.uid,\n        userName: user.displayName || user.email,\n        answers: userAnswers,\n        correct: correctAnswers,\n        score,\n        total: questions.length,\n        timestamp: new Date(),\n      });\n    } catch (err) {\n      console.error(\"Error al guardar respuestas:\", err);\n    }\n  };\n\n  const handleAnswer = (lessonId, qIndex, answerIndex) => {\n    setResponses((prev) => ({\n      ...prev,\n      [lessonId]: { ...prev[lessonId], [qIndex]: answerIndex },\n    }));\n  };\n\n  if (loading || !user) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <p>Cargando curso...</p>\n      </div>\n    );\n  }\n\n  if (error || !course) {\n    return (\n      <div className=\"p-6 text-center\">\n        <p className=\"text-red-600\">{error || \"Curso no encontrado\"}</p>\n        <button\n          onClick={() => router.push(\"/dashboard\")}\n          className=\"mt-4 text-blue-600 hover:underline\"\n        >\n          ‚Üê Volver al dashboard\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <Navbar user={user} userData={userData} />\n      <div className=\"min-h-screen bg-gray-50 py-8\">\n        <div className=\"max-w-6xl mx-auto px-4\">\n          {/* Encabezado */}\n          <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\n            <h1 className=\"text-2xl font-bold text-gray-800\">{course.title}</h1>\n            <p className=\"text-sm text-gray-500 mt-2\">\n              Progreso: {progress.length} / {course.lessons?.length || 0}{\" \"}\n              lecciones\n            </p>\n          </div>\n\n          {/* √çndice de lecciones */}\n          <div className=\"bg-white p-4 rounded-lg shadow mb-6\">\n            <h3 className=\"font-medium mb-2\">√çndice del curso</h3>\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\">\n              {course.lessons?.map((lesson, idx) => (\n                <button\n                  key={lesson.id}\n                  onClick={() => goToLesson(idx)}\n                  className={`p-2 text-xs text-center rounded border ${\n                    currentLessonIndex === idx\n                      ? \"bg-blue-100 border-blue-300\"\n                      : progress.includes(lesson.id)\n                      ? \"bg-green-100 border-green-300\"\n                      : \"bg-gray-100 border-gray-300 hover:bg-gray-200\"\n                  }`}\n                >\n                  {idx + 1}. {lesson.title.substring(0, 20)}...\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Vista de lecci√≥n */}\n          {selectedLesson && (\n            <div className=\"bg-white p-6 rounded-lg shadow mb-8\">\n              <h2 className=\"text-2xl font-semibold mb-4\">\n                {selectedLesson.title}\n              </h2>\n\n              {/* Contenido */}\n              {selectedLesson.type === \"text\" && (\n                <p className=\"text-gray-700 leading-relaxed\">\n                  {selectedLesson.content}\n                </p>\n              )}\n\n              {selectedLesson.type === \"video\" && (\n                <div>\n                  <p>‚ñ∂Ô∏è Video</p>\n                  <iframe\n                    className=\"w-full h-60 mt-2 rounded\"\n                    src={selectedLesson.content.replace(\"watch?v=\", \"embed/\")}\n                    title=\"Video\"\n                    allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                    allowFullScreen\n                  ></iframe>\n                </div>\n              )}\n\n              {selectedLesson.type === \"pdf\" && (\n                <div>\n                  <p>üìÑ PDF</p>\n                  <iframe\n                    className=\"w-full h-96 mt-2 rounded\"\n                    src={selectedLesson.content}\n                    title=\"PDF\"\n                  ></iframe>\n                </div>\n              )}\n\n              {selectedLesson.type === \"quiz\" &&\n                !quizSubmitted[selectedLesson.id] && (\n                  <div className=\"mt-4 border-t pt-4\">\n                    <h4 className=\"font-medium mb-3\">Responder Quiz</h4>\n                    {selectedLesson.content.map((q, qIndex) => (\n                      <div key={qIndex} className=\"mb-4\">\n                        <p>\n                          <strong>{qIndex + 1}.</strong> {q.question}\n                        </p>\n                        <div className=\"ml-4 mt-2 space-y-1\">\n                          {q.options.map((opt, oIndex) => (\n                            <label key={oIndex} className=\"flex items-center\">\n                              <input\n                                type=\"radio\"\n                                name={`q-${selectedLesson.id}-${qIndex}`}\n                                onChange={() =>\n                                  handleAnswer(\n                                    selectedLesson.id,\n                                    qIndex,\n                                    oIndex\n                                  )\n                                }\n                                className=\"mr-2\"\n                              />\n                              {opt}\n                            </label>\n                          ))}\n                        </div>\n                      </div>\n                    ))}\n                    <button\n                      onClick={() =>\n                        submitQuiz(selectedLesson.id, selectedLesson.content)\n                      }\n                      className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded\"\n                    >\n                      Enviar respuestas\n                    </button>\n                  </div>\n                )}\n\n              {selectedLesson.type === \"quiz\" &&\n                quizSubmitted[selectedLesson.id] && (\n                  <div className=\"mt-4 p-4 bg-green-100 rounded\">\n                    <h4>Quiz completado ‚úÖ</h4>\n                    <ul>\n                      {results[selectedLesson.id]?.map((isCorrect, idx) => (\n                        <li\n                          key={idx}\n                          className={\n                            isCorrect ? \"text-green-800\" : \"text-red-800\"\n                          }\n                        >\n                          Pregunta {idx + 1}:{\" \"}\n                          {isCorrect ? \"‚úÖ Correcta\" : \"‚ùå Incorrecta\"}\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n\n              {/* Calificaci√≥n de la lecci√≥n */}\n              <div className=\"mt-6 border-t pt-4\">\n                <h4 className=\"font-medium mb-2\">Califica esta lecci√≥n</h4>\n                <div className=\"flex mb-2\">\n                  {[1, 2, 3, 4, 5].map((star) => (\n                    <span\n                      key={star}\n                      className=\"text-2xl cursor-pointer\"\n                      onClick={() =>\n                        setLessonRatings({\n                          ...lessonRatings,\n                          [selectedLesson.id]: star,\n                        })\n                      }\n                      onMouseEnter={() =>\n                        setLessonHover({\n                          ...lessonHover,\n                          [selectedLesson.id]: star,\n                        })\n                      }\n                      onMouseLeave={() => setLessonHover({})}\n                    >\n                      {star <=\n                      (lessonHover[selectedLesson.id] ||\n                        lessonRatings[selectedLesson.id] ||\n                        0)\n                        ? \"‚≠ê\"\n                        : \"‚òÜ\"}\n                    </span>\n                  ))}\n                </div>\n                <textarea\n                  value={lessonReviews[selectedLesson.id] || \"\"}\n                  onChange={(e) =>\n                    setLessonReviews({\n                      ...lessonReviews,\n                      [selectedLesson.id]: e.target.value,\n                    })\n                  }\n                  rows=\"2\"\n                  className=\"w-full p-2 border border-gray-300 rounded mb-3\"\n                  placeholder=\"¬øQu√© te pareci√≥ esta lecci√≥n?\"\n                />\n              </div>\n\n              {/* Bot√≥n: Marcar y avanzar */}\n              <div className=\"mt-6\">\n                <button\n                  onClick={() => markAsCompletedAndNext(selectedLesson.id)}\n                  className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-medium\"\n                >\n                  {currentLessonIndex + 1 < (course.lessons?.length || 0)\n                    ? \"‚úÖ Marcar y siguiente\"\n                    : \"‚úÖ Finalizar curso\"}\n                </button>\n              </div>\n            </div>\n          )}\n\n          {/* Calificaci√≥n del curso (solo si complet√≥ todo) */}\n          {progress.length === course.lessons?.length &&\n            !submittedCourseReview && (\n              <div className=\"bg-white p-6 rounded-lg shadow\">\n                <h3 className=\"text-xl font-semibold mb-4\">\n                  ¬°Curso completado! üéâ\n                </h3>\n                <p>Gracias por completar el curso. Ahora puedes calificarlo.</p>\n                <div className=\"mt-4\">\n                  <div className=\"flex mb-2\">\n                    {[1, 2, 3, 4, 5].map((star) => (\n                      <span\n                        key={star}\n                        className=\"text-2xl cursor-pointer\"\n                        onClick={() => setCourseRating(star)}\n                        onMouseEnter={() => setCourseHover(star)}\n                        onMouseLeave={() => setCourseHover(0)}\n                      >\n                        {star <= (courseHover || courseRating) ? \"‚≠ê\" : \"‚òÜ\"}\n                      </span>\n                    ))}\n                  </div>\n                  <textarea\n                    value={courseReviewText}\n                    onChange={(e) => setCourseReviewText(e.target.value)}\n                    rows=\"3\"\n                    className=\"w-full p-3 border border-gray-300 rounded-lg mb-3\"\n                    placeholder=\"Tu opini√≥n ayuda a mejorar el curso...\"\n                  />\n                  <button\n                    onClick={submitCourseReview}\n                    className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded\"\n                  >\n                    Enviar calificaci√≥n\n                  </button>\n                </div>\n              </div>\n            )}\n        </div>\n      </div>\n    </>\n  );\n}\n"
        }
    ]
}