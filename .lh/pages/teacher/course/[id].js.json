{
    "sourceFile": "pages/teacher/course/[id].js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1755794210369,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755794397346,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,15 @@\n import { useState, useEffect } from \"react\";\n import { useRouter } from \"next/router\";\n import { onAuthStateChanged } from \"firebase/auth\";\n import { doc, getDoc, updateDoc } from \"firebase/firestore\";\n-import { auth, db } from \"../../../lib/firebase\";\n+import {\n+  ref,\n+  uploadBytes,\n+  getDownloadURL,\n+  deleteObject,\n+} from \"firebase/storage\";\n+import { auth, db, storage } from \"../../../lib/firebase\";\n \n export default function CourseLessonsPage() {\n   const router = useRouter();\n   const { id } = router.query;\n@@ -31,11 +37,13 @@\n   // Para editar descripci√≥n\n   const [isEditingDesc, setIsEditingDesc] = useState(false);\n   const [newDescription, setNewDescription] = useState(\"\");\n \n-  // ‚úÖ Nuevo: Para editar imagen de portada\n+  // ‚úÖ Nuevo: Para imagen de portada\n   const [isEditingCover, setIsEditingCover] = useState(false);\n-  const [coverImageUrl, setCoverImageUrl] = useState(\"\");\n+  const [uploading, setUploading] = useState(false);\n+  const [file, setFile] = useState(null); // Archivo seleccionado\n+  const [previewUrl, setPreviewUrl] = useState(\"\"); // Vista previa\n \n   // --- Estado para edici√≥n de lecci√≥n ---\n   const [editingLesson, setEditingLesson] = useState(null);\n \n@@ -88,9 +96,9 @@\n           setError(\"No tienes permiso para editar este curso.\");\n         } else {\n           setCourse(data);\n           setNewDescription(data.description || \"\");\n-          setCoverImageUrl(data.imageUrl || \"\"); // ‚Üê Cargar imagen\n+          setPreviewUrl(data.imageUrl || \"\"); // ‚Üê Usamos imageUrl como vista previa\n         }\n       } catch (err) {\n         setError(\"Error al cargar el curso.\");\n         console.error(err);\n@@ -101,8 +109,80 @@\n \n     loadCourse();\n   }, [user, id]);\n \n+  // --- Subir imagen a Storage ---\n+  const uploadCoverImage = async () => {\n+    if (!file) return null;\n+\n+    const allowedTypes = [\"image/jpeg\", \"image/jpg\", \"image/png\", \"image/webp\"];\n+    if (!allowedTypes.includes(file.type)) {\n+      alert(\"Solo se permiten im√°genes (JPG, PNG, WEBP).\");\n+      return null;\n+    }\n+\n+    if (file.size > 5 * 1024 * 1024) {\n+      alert(\"La imagen no debe superar los 5MB.\");\n+      return null;\n+    }\n+\n+    try {\n+      setUploading(true);\n+\n+      // Ruta en Storage\n+      const imagePath = `courses/${id}/cover.jpg`;\n+      const imageRef = ref(storage, imagePath);\n+\n+      // Si ya existe una imagen, eliminarla\n+      try {\n+        await deleteObject(imageRef);\n+      } catch (err) {\n+        // Puede que no exista, no es un error grave\n+      }\n+\n+      // Subir nueva imagen\n+      await uploadBytes(imageRef, file);\n+      const downloadUrl = await getDownloadURL(imageRef);\n+\n+      // Actualizar Firestore\n+      const courseDocRef = doc(db, \"courses\", id);\n+      await updateDoc(courseDocRef, {\n+        imageUrl: downloadUrl,\n+      });\n+\n+      // Actualizar estado\n+      setCourse({ ...course, imageUrl: downloadUrl });\n+      setPreviewUrl(downloadUrl);\n+      setIsEditingCover(false);\n+      setFile(null);\n+\n+      alert(\"Portada actualizada con √©xito.\");\n+      return downloadUrl;\n+    } catch (err) {\n+      console.error(\"Error al subir imagen:\", err);\n+      setError(\"No se pudo subir la imagen.\");\n+      return null;\n+    } finally {\n+      setUploading(false);\n+    }\n+  };\n+\n+  // --- Manejar cambio de archivo ---\n+  const handleFileChange = (e) => {\n+    const selectedFile = e.target.files[0];\n+    if (selectedFile) {\n+      setFile(selectedFile);\n+      setPreviewUrl(URL.createObjectURL(selectedFile)); // Vista previa local\n+    }\n+  };\n+\n+  // --- Cancelar edici√≥n de imagen ---\n+  const cancelImageEdit = () => {\n+    setIsEditingCover(false);\n+    setFile(null);\n+    setPreviewUrl(course.imageUrl || \"\"); // Restaurar\n+  };\n+\n   // --- Iniciar edici√≥n de una lecci√≥n ---\n   const startEditingLesson = (lesson) => {\n     setEditingLesson(lesson);\n     setTitle(lesson.title);\n@@ -243,35 +323,8 @@\n       console.error(err);\n     }\n   };\n \n-  // ‚úÖ Editar imagen de portada\n-  const handleUpdateCoverImage = async () => {\n-    if (!coverImageUrl.trim()) {\n-      alert(\"La URL de la imagen no puede estar vac√≠a.\");\n-      return;\n-    }\n-\n-    if (!isValidUrl(coverImageUrl)) {\n-      alert(\"Por favor ingresa una URL v√°lida (https://...)\");\n-      return;\n-    }\n-\n-    try {\n-      const courseDocRef = doc(db, \"courses\", id);\n-      await updateDoc(courseDocRef, {\n-        imageUrl: coverImageUrl.trim(),\n-      });\n-\n-      setCourse({ ...course, imageUrl: coverImageUrl.trim() });\n-      setIsEditingCover(false);\n-      alert(\"Portada actualizada con √©xito.\");\n-    } catch (err) {\n-      setError(\"No se pudo actualizar la imagen.\");\n-      console.error(err);\n-    }\n-  };\n-\n   if (loading || !user) {\n     return (\n       <div className=\"flex items-center justify-center min-h-screen\">\n         <p>Cargando curso...</p>\n@@ -314,12 +367,12 @@\n             <div>\n               <h3 className=\"text-sm font-medium text-gray-700 mb-2\">\n                 Portada del Curso\n               </h3>\n-              {course.imageUrl ? (\n+              {previewUrl ? (\n                 <div className=\"relative w-full h-40 mb-3 rounded-lg overflow-hidden border\">\n                   <img\n-                    src={course.imageUrl}\n+                    src={previewUrl}\n                     alt=\"Portada del curso\"\n                     className=\"w-full h-full object-cover\"\n                     onError={(e) => {\n                       e.target.src = \"/img/course-placeholder.jpg\";\n@@ -340,29 +393,48 @@\n             </div>\n           ) : (\n             <div className=\"mb-6\">\n               <h3 className=\"text-sm font-medium text-gray-700 mb-2\">\n-                URL de la Imagen de Portada\n+                Subir Imagen de Portada\n               </h3>\n+\n               <input\n-                type=\"url\"\n-                value={coverImageUrl}\n-                onChange={(e) => setCoverImageUrl(e.target.value)}\n-                placeholder=\"https://ejemplo.com/imagen.jpg\"\n-                className=\"w-full p-3 border border-gray-300 rounded-lg mb-3\"\n+                type=\"file\"\n+                accept=\"image/jpeg,image/png,image/webp\"\n+                onChange={handleFileChange}\n+                className=\"w-full p-2 border border-gray-300 rounded-lg mb-3\"\n               />\n+\n+              {previewUrl && (\n+                <div className=\"mt-3 mb-3\">\n+                  <p className=\"text-sm text-gray-600 mb-1\">Vista previa:</p>\n+                  <img\n+                    src={previewUrl}\n+                    alt=\"Vista previa\"\n+                    className=\"w-full h-32 object-cover rounded-lg border\"\n+                  />\n+                </div>\n+              )}\n+\n               <div className=\"flex gap-2\">\n                 <button\n-                  onClick={handleUpdateCoverImage}\n-                  className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-1 rounded text-sm\"\n+                  type=\"button\"\n+                  onClick={uploadCoverImage}\n+                  disabled={uploading || !file}\n+                  className=\"bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-4 py-1 rounded text-sm flex items-center gap-1\"\n                 >\n-                  Guardar Imagen\n+                  {uploading ? (\n+                    <>\n+                      <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n+                      Subiendo...\n+                    </>\n+                  ) : (\n+                    \"Guardar Imagen\"\n+                  )}\n                 </button>\n                 <button\n-                  onClick={() => {\n-                    setCoverImageUrl(course.imageUrl || \"\");\n-                    setIsEditingCover(false);\n-                  }}\n+                  type=\"button\"\n+                  onClick={cancelImageEdit}\n                   className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-1 rounded text-sm\"\n                 >\n                   Cancelar\n                 </button>\n"
                }
            ],
            "date": 1755794210369,
            "name": "Commit-0",
            "content": "import { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { onAuthStateChanged } from \"firebase/auth\";\nimport { doc, getDoc, updateDoc } from \"firebase/firestore\";\nimport { auth, db } from \"../../../lib/firebase\";\n\nexport default function CourseLessonsPage() {\n  const router = useRouter();\n  const { id } = router.query;\n\n  const [course, setCourse] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n  const [user, setUser] = useState(null);\n\n  // Para agregar/editar lecci√≥n\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n  const [type, setType] = useState(\"text\");\n  const [adding, setAdding] = useState(false);\n\n  // Para campos din√°micos\n  const [videoUrl, setVideoUrl] = useState(\"\");\n  const [pdfUrl, setPdfUrl] = useState(\"\");\n\n  // Para quizzes\n  const [questions, setQuestions] = useState([\n    { question: \"\", options: [\"\", \"\", \"\", \"\"], correct: 0 },\n  ]);\n\n  // Para editar descripci√≥n\n  const [isEditingDesc, setIsEditingDesc] = useState(false);\n  const [newDescription, setNewDescription] = useState(\"\");\n\n  // ‚úÖ Nuevo: Para editar imagen de portada\n  const [isEditingCover, setIsEditingCover] = useState(false);\n  const [coverImageUrl, setCoverImageUrl] = useState(\"\");\n\n  // --- Estado para edici√≥n de lecci√≥n ---\n  const [editingLesson, setEditingLesson] = useState(null);\n\n  // Validar URL\n  const isValidUrl = (string) => {\n    try {\n      new URL(string);\n      return true;\n    } catch (_) {\n      return false;\n    }\n  };\n\n  // Asegurar que `questions` siempre sea un array\n  useEffect(() => {\n    if (!Array.isArray(questions)) {\n      setQuestions([{ question: \"\", options: [\"\", \"\", \"\", \"\"], correct: 0 }]);\n    }\n  }, [questions]);\n\n  // Escuchar autenticaci√≥n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\n      if (currentUser) {\n        setUser(currentUser);\n      } else {\n        router.push(\"/login\");\n      }\n    });\n\n    return () => unsubscribe();\n  }, [router]);\n\n  // Cargar curso\n  useEffect(() => {\n    if (!user || !id) return;\n\n    const loadCourse = async () => {\n      try {\n        const courseDocRef = doc(db, \"courses\", id);\n        const courseDocSnap = await getDoc(courseDocRef);\n\n        if (!courseDocSnap.exists()) {\n          setError(\"Curso no encontrado.\");\n          return;\n        }\n\n        const data = courseDocSnap.data();\n        if (data.teacherId !== user.uid) {\n          setError(\"No tienes permiso para editar este curso.\");\n        } else {\n          setCourse(data);\n          setNewDescription(data.description || \"\");\n          setCoverImageUrl(data.imageUrl || \"\"); // ‚Üê Cargar imagen\n        }\n      } catch (err) {\n        setError(\"Error al cargar el curso.\");\n        console.error(err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadCourse();\n  }, [user, id]);\n\n  // --- Iniciar edici√≥n de una lecci√≥n ---\n  const startEditingLesson = (lesson) => {\n    setEditingLesson(lesson);\n    setTitle(lesson.title);\n    setType(lesson.type);\n\n    // Resetear todos los campos\n    setContent(\"\");\n    setVideoUrl(\"\");\n    setPdfUrl(\"\");\n    setQuestions([{ question: \"\", options: [\"\", \"\", \"\", \"\"], correct: 0 }]);\n\n    if (lesson.type === \"text\") {\n      setContent(lesson.content || \"\");\n    } else if (lesson.type === \"video\") {\n      setVideoUrl(lesson.content || \"\");\n    } else if (lesson.type === \"pdf\") {\n      setPdfUrl(lesson.content || \"\");\n    } else if (lesson.type === \"quiz\") {\n      const quizContent = Array.isArray(lesson.content) ? lesson.content : [];\n      setQuestions(JSON.parse(JSON.stringify(quizContent)));\n    }\n  };\n\n  // --- Cancelar edici√≥n ---\n  const cancelEdit = () => {\n    setEditingLesson(null);\n    setTitle(\"\");\n    setContent(\"\");\n    setVideoUrl(\"\");\n    setPdfUrl(\"\");\n    setQuestions([{ question: \"\", options: [\"\", \"\", \"\", \"\"], correct: 0 }]);\n    setType(\"text\");\n  };\n\n  // --- Agregar o actualizar lecci√≥n ---\n  const handleAddLesson = async (e) => {\n    e.preventDefault();\n    if (!title.trim()) return;\n\n    setAdding(true);\n    setError(\"\");\n\n    try {\n      let lessonContent = \"\";\n\n      if (type === \"text\") {\n        if (!content.trim()) {\n          setError(\"El contenido no puede estar vac√≠o.\");\n          setAdding(false);\n          return;\n        }\n        lessonContent = content.trim();\n      } else if (type === \"video\") {\n        if (!videoUrl.trim() || !isValidUrl(videoUrl)) {\n          setError(\"Por favor ingresa una URL de video v√°lida.\");\n          setAdding(false);\n          return;\n        }\n        lessonContent = videoUrl.trim();\n      } else if (type === \"pdf\") {\n        if (!pdfUrl.trim() || !pdfUrl.toLowerCase().endsWith(\".pdf\")) {\n          setError(\"Por favor ingresa una URL v√°lida terminada en .pdf\");\n          setAdding(false);\n          return;\n        }\n        lessonContent = pdfUrl.trim();\n      } else if (type === \"quiz\") {\n        if (!Array.isArray(questions) || questions.length === 0) {\n          setError(\"Debes agregar al menos una pregunta.\");\n          setAdding(false);\n          return;\n        }\n        const isValid = questions.every(\n          (q) =>\n            q.question?.trim() &&\n            Array.isArray(q.options) &&\n            q.options.every((opt) => opt?.trim()) &&\n            q.correct >= 0 &&\n            q.correct < 4\n        );\n        if (!isValid) {\n          setError(\n            \"Completa todas las preguntas, opciones y selecciona la respuesta correcta.\"\n          );\n          setAdding(false);\n          return;\n        }\n        lessonContent = questions;\n      }\n\n      const newLesson = {\n        id: editingLesson ? editingLesson.id : `les_${Date.now()}`,\n        title: title.trim(),\n        type,\n        content: lessonContent,\n        order: editingLesson\n          ? editingLesson.order\n          : course.lessons?.length || 0,\n        createdAt: editingLesson ? editingLesson.createdAt : new Date(),\n      };\n\n      const updatedLessons = editingLesson\n        ? course.lessons.map((l) => (l.id === editingLesson.id ? newLesson : l))\n        : [...(course.lessons || []), newLesson];\n\n      const courseDocRef = doc(db, \"courses\", id);\n      await updateDoc(courseDocRef, {\n        lessons: updatedLessons,\n      });\n\n      setCourse({ ...course, lessons: updatedLessons });\n      cancelEdit();\n    } catch (err) {\n      setError(\"No se pudo guardar la lecci√≥n.\");\n      console.error(err);\n    } finally {\n      setAdding(false);\n    }\n  };\n\n  // ‚úÖ Editar descripci√≥n del curso\n  const handleUpdateDescription = async () => {\n    if (!newDescription.trim()) {\n      alert(\"La descripci√≥n no puede estar vac√≠a\");\n      return;\n    }\n\n    try {\n      const courseDocRef = doc(db, \"courses\", id);\n      await updateDoc(courseDocRef, {\n        description: newDescription.trim(),\n      });\n\n      setCourse({ ...course, description: newDescription.trim() });\n      setIsEditingDesc(false);\n    } catch (err) {\n      setError(\"No se pudo actualizar la descripci√≥n.\");\n      console.error(err);\n    }\n  };\n\n  // ‚úÖ Editar imagen de portada\n  const handleUpdateCoverImage = async () => {\n    if (!coverImageUrl.trim()) {\n      alert(\"La URL de la imagen no puede estar vac√≠a.\");\n      return;\n    }\n\n    if (!isValidUrl(coverImageUrl)) {\n      alert(\"Por favor ingresa una URL v√°lida (https://...)\");\n      return;\n    }\n\n    try {\n      const courseDocRef = doc(db, \"courses\", id);\n      await updateDoc(courseDocRef, {\n        imageUrl: coverImageUrl.trim(),\n      });\n\n      setCourse({ ...course, imageUrl: coverImageUrl.trim() });\n      setIsEditingCover(false);\n      alert(\"Portada actualizada con √©xito.\");\n    } catch (err) {\n      setError(\"No se pudo actualizar la imagen.\");\n      console.error(err);\n    }\n  };\n\n  if (loading || !user) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <p>Cargando curso...</p>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6 max-w-3xl mx-auto\">\n        <div className=\"p-4 bg-red-100 text-red-700 rounded mb-4\">\n          <strong>Error:</strong> {error}\n        </div>\n        <button\n          onClick={() => router.push(\"/dashboard\")}\n          className=\"text-blue-600 hover:underline\"\n        >\n          ‚Üê Volver al dashboard\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen p-10 grid grid-cols-1 lg:grid-cols-2 gap-8 bg-gray-50\">\n      {/* Columna izquierda: Informaci√≥n del curso */}\n      <div className=\"bg-white p-6 rounded-lg shadow\">\n        <button\n          onClick={() => router.back()}\n          className=\"mb-6 text-blue-600 hover:underline flex items-center gap-1\"\n        >\n          ‚Üê Volver\n        </button>\n\n        <h1 className=\"text-2xl font-bold text-gray-800\">{course.title}</h1>\n\n        {/* ‚úÖ Editar imagen de portada */}\n        <div className=\"mt-6\">\n          {!isEditingCover ? (\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-700 mb-2\">\n                Portada del Curso\n              </h3>\n              {course.imageUrl ? (\n                <div className=\"relative w-full h-40 mb-3 rounded-lg overflow-hidden border\">\n                  <img\n                    src={course.imageUrl}\n                    alt=\"Portada del curso\"\n                    className=\"w-full h-full object-cover\"\n                    onError={(e) => {\n                      e.target.src = \"/img/course-placeholder.jpg\";\n                    }}\n                  />\n                </div>\n              ) : (\n                <div className=\"w-full h-40 mb-3 bg-gray-200 rounded-lg flex items-center justify-center\">\n                  <span className=\"text-gray-500 text-sm\">Sin imagen</span>\n                </div>\n              )}\n              <button\n                onClick={() => setIsEditingCover(true)}\n                className=\"text-sm text-indigo-600 hover:underline\"\n              >\n                ‚úèÔ∏è Cambiar portada\n              </button>\n            </div>\n          ) : (\n            <div className=\"mb-6\">\n              <h3 className=\"text-sm font-medium text-gray-700 mb-2\">\n                URL de la Imagen de Portada\n              </h3>\n              <input\n                type=\"url\"\n                value={coverImageUrl}\n                onChange={(e) => setCoverImageUrl(e.target.value)}\n                placeholder=\"https://ejemplo.com/imagen.jpg\"\n                className=\"w-full p-3 border border-gray-300 rounded-lg mb-3\"\n              />\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={handleUpdateCoverImage}\n                  className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-1 rounded text-sm\"\n                >\n                  Guardar Imagen\n                </button>\n                <button\n                  onClick={() => {\n                    setCoverImageUrl(course.imageUrl || \"\");\n                    setIsEditingCover(false);\n                  }}\n                  className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-1 rounded text-sm\"\n                >\n                  Cancelar\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Editar descripci√≥n */}\n        <div className=\"mt-6\">\n          {!isEditingDesc ? (\n            <div>\n              <p className=\"text-gray-600 whitespace-pre-line\">\n                {course.description}\n              </p>\n              <button\n                onClick={() => setIsEditingDesc(true)}\n                className=\"text-sm text-indigo-600 hover:underline mt-2\"\n              >\n                ‚úèÔ∏è Editar descripci√≥n\n              </button>\n            </div>\n          ) : (\n            <div>\n              <textarea\n                value={newDescription}\n                onChange={(e) => setNewDescription(e.target.value)}\n                rows=\"5\"\n                className=\"w-full p-3 border border-gray-300 rounded-lg mb-3\"\n                placeholder=\"Escribe la descripci√≥n del curso...\"\n              />\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={handleUpdateDescription}\n                  className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-1 rounded text-sm\"\n                >\n                  Guardar\n                </button>\n                <button\n                  onClick={() => {\n                    setNewDescription(course.description);\n                    setIsEditingDesc(false);\n                  }}\n                  className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-1 rounded text-sm\"\n                >\n                  Cancelar\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        <p className=\"text-sm text-gray-500 mt-4\">\n          {course.lessons?.length || 0} lecciones\n        </p>\n      </div>\n\n      {/* Columna derecha: Formulario y lista */}\n      <div className=\"space-y-8\">\n        {/* Formulario: Agregar o Editar */}\n        <form\n          onSubmit={handleAddLesson}\n          className=\"bg-white p-6 rounded-lg shadow\"\n        >\n          <h2 className=\"text-xl font-semibold mb-4\">\n            {editingLesson ? \"Editar Lecci√≥n\" : \"Agregar Nueva Lecci√≥n\"}\n          </h2>\n\n          {/* T√≠tulo */}\n          <div className=\"mb-4\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              T√≠tulo *\n            </label>\n            <input\n              type=\"text\"\n              value={title}\n              onChange={(e) => setTitle(e.target.value)}\n              required\n              className=\"w-full p-3 border border-gray-300 rounded-lg\"\n              placeholder=\"Ej: Introducci√≥n al Marketing\"\n            />\n          </div>\n\n          {/* Tipo */}\n          <div className=\"mb-4\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Tipo de Contenido\n            </label>\n            <select\n              value={type}\n              onChange={(e) => {\n                setType(e.target.value);\n                setVideoUrl(\"\");\n                setPdfUrl(\"\");\n                setContent(\"\");\n                if (e.target.value !== \"quiz\") {\n                  setQuestions([\n                    { question: \"\", options: [\"\", \"\", \"\", \"\"], correct: 0 },\n                  ]);\n                }\n              }}\n              className=\"w-full p-3 border border-gray-300 rounded-lg\"\n            >\n              <option value=\"text\">Texto</option>\n              <option value=\"video\">Video</option>\n              <option value=\"pdf\">PDF</option>\n              <option value=\"quiz\">Cuestionario</option>\n            </select>\n          </div>\n\n          {/* Contenido condicional */}\n          {type === \"text\" && (\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Contenido\n              </label>\n              <textarea\n                value={content}\n                onChange={(e) => setContent(e.target.value)}\n                rows=\"4\"\n                className=\"w-full p-3 border border-gray-300 rounded-lg\"\n                placeholder=\"Escribe el contenido de la lecci√≥n...\"\n              />\n            </div>\n          )}\n\n          {type === \"video\" && (\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                URL del Video\n              </label>\n              <input\n                type=\"url\"\n                value={videoUrl}\n                onChange={(e) => setVideoUrl(e.target.value)}\n                required\n                className=\"w-full p-3 border border-gray-300 rounded-lg\"\n                placeholder=\"https://youtube.com/watch?v=...\"\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Soporta YouTube, Vimeo u otros enlaces directos.\n              </p>\n            </div>\n          )}\n\n          {type === \"pdf\" && (\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                URL del PDF\n              </label>\n              <input\n                type=\"url\"\n                value={pdfUrl}\n                onChange={(e) => setPdfUrl(e.target.value)}\n                required\n                className=\"w-full p-3 border border-gray-300 rounded-lg\"\n                placeholder=\"https://ejemplo.com/archivo.pdf\"\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Usa enlaces p√∫blicos (Google Drive, Dropbox, etc. con acceso\n                compartido).\n              </p>\n            </div>\n          )}\n\n          {type === \"quiz\" && (\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Preguntas del Quiz\n              </label>\n\n              {Array.isArray(questions) ? (\n                questions.map((q, qIndex) => (\n                  <div\n                    key={qIndex}\n                    className=\"border border-gray-300 rounded-lg p-4 mb-4 bg-gray-50\"\n                  >\n                    <div className=\"mb-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Escribe la pregunta\"\n                        value={q.question || \"\"}\n                        onChange={(e) => {\n                          const newQuestions = [...questions];\n                          newQuestions[qIndex].question = e.target.value;\n                          setQuestions(newQuestions);\n                        }}\n                        className=\"w-full p-2 border border-gray-300 rounded\"\n                        required\n                      />\n                    </div>\n\n                    <div className=\"space-y-2 mb-3\">\n                      {q.options.map((opt, oIndex) => (\n                        <div key={oIndex} className=\"flex items-center\">\n                          <input\n                            type=\"radio\"\n                            name={`correct-${qIndex}`}\n                            checked={q.correct === oIndex}\n                            onChange={() => {\n                              const newQuestions = [...questions];\n                              newQuestions[qIndex].correct = oIndex;\n                              setQuestions(newQuestions);\n                            }}\n                            className=\"mr-2\"\n                          />\n                          <input\n                            type=\"text\"\n                            placeholder={`Opci√≥n ${oIndex + 1}`}\n                            value={opt || \"\"}\n                            onChange={(e) => {\n                              const newQuestions = [...questions];\n                              newQuestions[qIndex].options[oIndex] =\n                                e.target.value;\n                              setQuestions(newQuestions);\n                            }}\n                            className=\"flex-1 p-2 border border-gray-300 rounded\"\n                            required\n                          />\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                ))\n              ) : (\n                <p className=\"text-red-600\">\n                  Error: el contenido del quiz no es v√°lido.\n                </p>\n              )}\n\n              <button\n                type=\"button\"\n                onClick={() =>\n                  setQuestions([\n                    ...questions,\n                    { question: \"\", options: [\"\", \"\", \"\", \"\"], correct: 0 },\n                  ])\n                }\n                className=\"text-sm text-blue-600 hover:underline mb-4\"\n              >\n                + Agregar otra pregunta\n              </button>\n            </div>\n          )}\n\n          {/* Botones */}\n          <div className=\"flex gap-3\">\n            <button\n              type=\"submit\"\n              disabled={adding}\n              className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium rounded-lg flex items-center gap-2\"\n            >\n              {adding ? (\n                <>\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n                  {editingLesson ? \"Guardando...\" : \"Agregando...\"}\n                </>\n              ) : (\n                \"Guardar Cambios\"\n              )}\n            </button>\n\n            {editingLesson && (\n              <button\n                type=\"button\"\n                onClick={cancelEdit}\n                className=\"px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium rounded-lg\"\n              >\n                Cancelar\n              </button>\n            )}\n          </div>\n        </form>\n\n        {/* Lista de lecciones */}\n        <div className=\"bg-white p-6 rounded-lg shadow\">\n          <h2 className=\"text-xl font-semibold mb-4\">Lecciones del Curso</h2>\n          {course.lessons && course.lessons.length > 0 ? (\n            <ul className=\"space-y-3\">\n              {course.lessons\n                .sort((a, b) => a.order - b.order)\n                .map((lesson) => (\n                  <li\n                    key={lesson.id}\n                    className=\"p-4 border border-gray-200 rounded-lg bg-gray-50\"\n                  >\n                    <div className=\"flex justify-between items-start\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-medium text-gray-800\">\n                          {lesson.title}\n                        </h3>\n\n                        {lesson.type === \"text\" && (\n                          <p className=\"text-sm text-gray-600 mt-1 line-clamp-2\">\n                            {lesson.content}\n                          </p>\n                        )}\n\n                        {lesson.type === \"video\" && (\n                          <div className=\"mt-2\">\n                            <span className=\"inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded\">\n                              ‚ñ∂Ô∏è Video\n                            </span>\n                            <a\n                              href={lesson.content}\n                              target=\"_blank\"\n                              rel=\"noopener noreferrer\"\n                              className=\"block text-sm text-indigo-600 hover:underline mt-1\"\n                            >\n                              Ver video\n                            </a>\n                          </div>\n                        )}\n\n                        {lesson.type === \"pdf\" && (\n                          <div className=\"mt-2\">\n                            <span className=\"inline-block px-2 py-1 text-xs bg-red-100 text-red-800 rounded\">\n                              üìÑ PDF\n                            </span>\n                            <a\n                              href={lesson.content}\n                              target=\"_blank\"\n                              rel=\"noopener noreferrer\"\n                              className=\"block text-sm text-red-600 hover:underline mt-1\"\n                            >\n                              Abrir PDF\n                            </a>\n                          </div>\n                        )}\n\n                        {lesson.type === \"quiz\" && (\n                          <div className=\"mt-2\">\n                            <span className=\"inline-block px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded\">\n                              üìù Quiz\n                            </span>\n                            <p className=\"text-sm text-gray-600 mt-1\">\n                              {Array.isArray(lesson.content)\n                                ? lesson.content.length\n                                : 0}{\" \"}\n                              preguntas\n                            </p>\n                          </div>\n                        )}\n\n                        <span className=\"inline-block mt-2 px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded\">\n                          {lesson.type === \"text\"\n                            ? \"Texto\"\n                            : lesson.type === \"video\"\n                            ? \"Video\"\n                            : lesson.type === \"pdf\"\n                            ? \"PDF\"\n                            : \"Cuestionario\"}\n                        </span>\n                      </div>\n\n                      <div className=\"ml-4 flex gap-2\">\n                        <button\n                          onClick={() => startEditingLesson(lesson)}\n                          className=\"text-sm text-indigo-600 hover:underline\"\n                        >\n                          ‚úèÔ∏è Editar\n                        </button>\n                      </div>\n                    </div>\n                  </li>\n                ))}\n            </ul>\n          ) : (\n            <p className=\"text-gray-500\">A√∫n no hay lecciones en este curso.</p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"
        }
    ]
}